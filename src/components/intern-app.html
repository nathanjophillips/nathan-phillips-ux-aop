<link rel="import" href="~@banno/polymer/polymer-element.html">
<link rel="import" href="~@banno/polymer/lib/elements/dom-if.html">
<link rel="import" href="./user-list.html">
<link rel="import" href="../../node_modules/@banno/jha-design-components/icons/jha-icon-add.html">
<link rel="import" href="../../node_modules/@banno/jha-design-components/icons/jha-icon-person-add.html">

<dom-module id="intern-app">
 <template>
  <style>
    h1 {
      font-size: 45px;
      padding: 12px 20px;
      margin: 0px;
    }
  
    .expand {
      display: table-row;
      transition: all 0.3s ease;
    }
  
    .collapse {
      display: none;
      transition: all 0.3s ease;
    }
  
    .add-button {
      background-color: #fca902;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      padding: 18px;
      font-size: 20px;
      padding-right: 30px;
      padding-left: 30px;
      text-align: center;
      margin: 15px;
      border-radius: 4px;
      font-weight: 400;
      color: #fcfcff;
    }
    
    .add-button:hover {
      opacity: 0.9;
      transition: all 0.3s ease;
    }
  
    .delete-all-button {
      position: fixed;
      top: 90%;
      right: 2%;
      width: 150px;
      background-color: #d1250ee3;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      color: #fcfcff;
      border-radius: 4px;
      text-align: center;
      padding: 12px;
      margin-top: 20px;
      font-size: 12px;
    }

    .delete-all-button:hover {
      opacity: 0.9;
      transition: all 0.3s ease;
    }

    .collapse-all-button {
      position: fixed;
      top: 83%;
      right: 2%;
      width: 150px;
      background-color: indigo;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      color: #fcfcff;
      border-radius: 4px;
      text-align: center;
      padding: 12px;
      margin-top: 20px;
      font-size: 12px;
    }

    .collapse-all-button:hover {
      opacity: 0.9;
      transition: all 0.3s ease;
    }
    
  </style>
   <header>
     <h1>Intern App</h1>
   </header>
   <template is="dom-if" if="[[!addUserSelected]]">
     <button class="add-button" type="button" on-click="createNewUserProfile">[[changeButtonText(addUserSelected)]]<jha-icon-person-add style="fill:#fcfcff; display: -webkit-inline-box;
      vertical-align: text-bottom; padding-left: 13px;"></jha-icon-person-add></button>
   </template>
   <user-list user-profiles="[[userProfiles]]" add-user-selected="[[addUserSelected]]"></user-list>
   <template is="dom-if" if="[[cardsPopulated]]">
      <button class="delete-all-button" type="button" on-click="deleteAll">Delete All Users <jha-icon-delete style="height: 16px; width: 16px; vertical-align: text-bottom; fill:#fcfcff;"></jha-icon-delete></button>
   </template>
 </template>
 <script type="module">
   'use strict';
   import localStorageApi from "../api/local-storage.js";
   class InternApp extends Polymer.Element {
     static get is() { return 'intern-app'; }

     static get properties() {
       return {
         userProfiles: {
           type: Array,
           value: () => localStorageApi.getUsers()
         },
         addUserSelected: {
           type: Boolean,
           value: false
         },
         isExpanded: {
            type: Boolean,
            value: true
          },
          isPopulated: {
            type: Boolean,
            value: true
          },
         cardsPopulated: {
            type: Boolean,
            value: false
         }
       }
     }

     constructor() {
       super();
       this.boundNewUser = this.newUser.bind(this);
       this.boundDeleteUser = this.deleteUser.bind(this);
     }

     connectedCallback() {
       super.connectedCallback();
       window.addEventListener("newUser", this.boundNewUser);
       window.addEventListener("deleteUser", this.boundDeleteUser);
     }

     disconnectedCallback() {
       super.disconnectedCallback();
       window.removeEventListener("newUser", this.boundNewUser);
       window.removeEventListener("deleteUser", this.boundDeleteUser);
     }

     deleteAll() {
      if (window.confirm("Are you sure you want to delete all users?")) {
        this.set('userProfiles', localStorageApi.deleteUsers());
        this.cardsPopulated = false;
        }  
      } 

      deleteUser(event) {
        this.set('userProfiles', localStorageApi.getUsers());
      }

     newUser(event) {
       const newUserProfile = event.detail;
       newUserProfile.id = localStorageApi.genId();
       this.pushToArray(this.userProfiles, newUserProfile);
       this.addUserSelected = false;
       this.cardsPopulated = true;
     }

     pushToArray(userProfiles, newUserProfile) {
       if (localStorageApi.validateUser(newUserProfile)) {
         localStorageApi.createUser(newUserProfile);
         this.push('userProfiles', newUserProfile);
       }
     }

     createNewUserProfile(event) {
       this.addUserSelected = !this.addUserSelected;
     }

     changeButtonText(addUserSelected) {
       return addUserSelected ? `Save` : `Create User `;
     }
   }
   customElements.define(InternApp.is, InternApp);
   export default InternApp;
 </script>
</dom-module>
