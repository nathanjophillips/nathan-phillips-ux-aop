<link rel="import" href="~@banno/polymer/polymer-element.html">
<link rel="import" href="~@banno/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../node_modules/@banno/jha-design-components/icons/jha-icon-email.html">
<link rel="import" href="../../node_modules/@banno/jha-design-components/icons/jha-icon-phone.html">

<dom-module id="user-profile">
  <template>
    <style>
       @import url('https://fonts.googleapis.com/css?family=Poppins');

      table {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        background: #eef1f4;
        border-radius: 3px;
        padding: 30px;
        margin-top: 10px;
        max-width: 400px;
        min-width: 400px;
      }

      button {
        background-color: DarkSlateBlue;
        color: #fcfcff;
        border-radius: 3px;
        text-align: center;
        padding: 12px;
        margin-top: 20px;
        font-size: 12px;
      }

      button:hover {
      opacity: 0.9;
      }

      label {
        margin-top: 25px;
        padding-right: 5px;
      }

      input {
        font-size: 18px;
        border: 0;
        border-bottom: 1px solid indigo;
        background: transparent;
      }  
    </style>
    <template is="dom-if" if="[[addUserSelected]]">
      <table>
        <tr>
          <td><label for="firstName">First name :</label></td>
          <td><input type="text" name="firstName" id="firstName" value="{{user.firstName}}" on-input="updateUserFirstName"></td>
        </tr>
        <tr>
          <td><label for="lastName">Last name :</label></td>
          <td><input type="text" name="lastName" id="lastName" value="{{user.lastName}}" on-input="updateUserLastName"></td>
        </tr>
        <tr>
          <td><label for="phone">Phone :</label></td>
          <td><input type="text" name="phone" id="phone" value="{{user.phoneNumber}}" on-input="updateUserPhoneNumber"></td>
        </tr>
        <tr>
          <td><label for="email">Email :</label></td>
          <td><input type="text" name="email" id="email" value="{{user.email}}" on-input="updateUserEmail"></td>
        </tr>
        <tr>
          <td><button type="button" on-click="newProfile">[[changeButtonText(addUserSelected)]]</button></td>
        </tr>
      </table>
    </template>
    <template is="dom-if" if="[[isPopulated]]">
        <table>
          <tr>
            <td>ID:</td>
            <td>[[user.id]]</td>
          </tr>
          <tr>
            <td>Name:</td>
            <td>[[user.firstName]] [[user.lastName]]</td>
          </tr>
          <template is="dom-if" if="[[isExpanded]]">
            <tr>
              <td><jha-icon-phone></jha-icon-phone></td>
              <td>[[user.phoneNumber]]</td>
            </tr>
            <tr>
              <td><jha-icon-email></jha-icon-email></td>
              <td>[[user.email]]</td>
            </tr>
          </template>
          <tr>
            <td><button on-click="cardExpandCollapse">[[collapseButtonText(isExpanded)]]</button></td>
            <td><button type="button" on-click="editUserProfile">[[editButtonText(editSelected)]]</button></td>
            <td><button type="button" on-click="deleteUserProfile">Delete</button></td>
          </tr>
        </table>
    </template>
    <template is="dom-if" if="[[editSelected]]">
        <table>
          <tr>
            <td><label for="firstName">First name :</label></td>
            <td><input type="text" name="firstName" id="firstName" value="{{user.firstName}}" on-input="updateUserFirstName"></td>
          </tr>
          <tr>
            <td><label for="lastName">Last name :</label></td>
            <td><input type="text" name="lastName" id="lastName" value="{{user.lastName}}" on-input="updateUserLastName"></td>
          </tr>
          <tr>
            <td><label for="phone">Phone :</label></td>
            <td><input type="text" name="phone" id="phone" value="{{user.phoneNumber}}" on-input="updateUserPhoneNumber"></td>
          </tr>
          <tr>
            <td><label for="email">Email :</label></td>
            <td><input type="text" name="email" id="email" value="{{user.email}}" on-input="updateUserEmail"></td>
          </tr>
          <tr>
            <td><button type="button" on-click="editUserProfile">[[editButtonText(editSelected)]]</button></td>
          </tr>
        </table>
    </template>
    
  </template>
  <script type="module">
    'use strict';
    import localStorageApi from "../api/local-storage.js";
    class UserProfile extends Polymer.Element {
      static get is() { return 'user-profile'; }

      static get properties() {
        return {
          isExpanded: {
            type: Boolean,
            value: true
          },
          editSelected: {
            type: Boolean,
            value: false
          },
          user: {
            type: Object,
            value: function() {
              return {
                id: '',
                firstName: '',
                lastName: '',
                phoneNumber: '',
                email: ''
              };
            }
          },
          addUserSelected: {
            type: Boolean,
          },
          isPopulated: {
            type: Boolean,
          }
        }
      }

      newProfile(event) {
        this.dispatchEvent(new CustomEvent("newUser", {
          bubbles: true,
          composed: true,
          detail: this.user
        }));
        this.user = {
          id: '',
          firstName: '',
          lastName: '',
          phoneNumber: '',
          email: ''
        };
      }

      // deleteUserProfile(id) {
      //   localStorageApi.deleteUser(id);
      // }


      cardExpandCollapse(event) {
        this.isExpanded = !this.isExpanded;
      }

      editUserProfile(event) {
        this.editSelected = !this.editSelected;
        this.isPopulated = !this.isPopulated;
      }

      collapseButtonText(isExpanded) {
        return isExpanded ? `Collapse` : `Expand`;
      }

      editButtonText(editSelected) {
        return editSelected ? `Save` : `Edit`;
      }

      changeButtonText(addUserSelected) {
        return addUserSelected ? `Save` : `Create User` ;
      }

      updateUserFirstName(event) {
        this.set('user.firstName', event.target.value);
      }

      updateUserLastName(event) {
        this.set('user.lastName', event.target.value);
      }

      updateUserPhoneNumber(event) {
        this.set('user.phoneNumber', event.target.value);
      }

      updateUserEmail(event) {
        this.set('user.email', event.target.value);
      }
    }
    customElements.define(UserProfile.is, UserProfile);
    export default UserProfile;
  </script>
  </dom-module>
